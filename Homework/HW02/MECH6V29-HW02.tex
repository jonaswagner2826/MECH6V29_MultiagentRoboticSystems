\documentclass[]{article}
\renewcommand{\baselinestretch}{1.25}

\usepackage[margin=1in]{geometry}
\usepackage{physics}
\usepackage{amsmath, amsfonts, amssymb, amsthm}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage{empheq}

% MATLAB Formatting Code
\usepackage[numbered,framed]{matlab-prettifier}
\lstset{style=Matlab-editor,columns=fullflexible}
\renewcommand{\lstlistingname}{Script}
\newcommand{\scriptname}{\lstlistingname}

% TikZ Things
\usepackage{tikz}
\usetikzlibrary{positioning,shapes}


% Formatting Preferences
\numberwithin{equation}{section}
\usepackage{parskip}
\renewcommand{\figurename}{Fig.}
\allowdisplaybreaks

% Section Heading Settings
\usepackage{enumitem}
\renewcommand{\theenumi}{\alph{enumi}}
\renewcommand*{\thesection}{Problem \arabic{section}}
\renewcommand*{\thesubsection}{\alph{subsection})}
\renewcommand*{\thesubsubsection}{\quad \quad \roman{subsubsection})}

% Math Proof things
\newcommand{\Rel}{\mathcal{R}}
\newcommand{\R}{\mathbb{R}}
\newcommand{\C}{\mathbb{C}}
\newcommand{\N}{\mathbb{N}}
\newcommand{\Z}{\mathbb{Z}}
\newcommand{\Q}{\mathbb{Q}}

\newcommand{\st}{\ : \ }

% Theorem Definition
\newtheorem{definition}{Definition}
\newtheorem{assumption}{Assumption}
\newtheorem{theorem}{Theorem}
\newtheorem{lemma}{Lemma}
\newtheorem{proposition}{Proposition}
\newtheorem{example}{Example}


% Multiagent Robotic Systems Commands
\newcommand{\diam}{\textnormal{diam}}
\newcommand{\radius}{\textnormal{radius}}




%opening
\title{MECH 6V29: Multiagent Robotic Systems- HW 2}
\author{Jonas Wagner}
\date{2022, March 1\textsuperscript{st}}

\begin{document}	

\maketitle

\tableofcontents

%----------------------------------------------------------------------------

% Problem 1 -------------------------------------------------
\newpage
\section{}
% \textbf{Problem:} 
State a summary of lectures \emph{\textbf{lectures 6-10}}, preferably by creating a concept map diagram (flow diagram). 
The whole purpose is to make sure that we are clear about the bigger picture, 
and reiterate why are we doing and discussing the specific topics in the class. 
Do not merely write the topics, instead create connections between topics to clarify the flow of information.

\subsection{Big Picture Chart}
\begin{figure}[h]
	\centering
    \resizebox*{\textwidth}{!}{\begin{tikzpicture}[
		empty/.style={coordinate, draw=white!0, fill=white!0, thin, minimum size = 0.1mm},
		block/.style={rectangle, draw=blue!80, fill=blue!10, very thick, minimum size = 15mm},
		extra/.style={ellipse, draw=red!80, fill=red!10, thick, minimum size = 10mm},
		auto,
		% roundnode/.style={circle, draw=green!60, fill=green!5, very thick, minimum size=7mm},
		% squarednode/.style={rectangle, draw=red!60, fill=red!5, very thick, minimum size=5mm},
		]
		%Main Nodes
		\node[empty]	(center)								{};
		\node[block, text width = 30mm]	(consensus)	[above=of center]	{Consensus Problem $\dot{x}=-L x$};
		\node[block]	(lyap)		[left=of center] 	{Lyapnov Stability};
		\node[block]	(lead_follow)		[right=of center] 	{Leader-Follower Network};
        % \node[block]	(applications)		[below=of center]	{Real-world Applications};

        %Consensus
        \node[extra]	(con_2)		[above=of consensus]	{Adjacency Matrix: $A$};
        \node[extra]	(con_1)		[left=of con_2]			{Degree Matrix: $\Delta$};
        \node[extra]	(con_3)		[right=of con_2]		{Incidence Matrix: $D$};
        \node[extra]	(con_4)		[above=of con_2]		{Laplacian: $L = \Delta - A = DD^T$};
        \draw[-]	(consensus.north) 	--	(con_1.south);
        \draw[-]	(consensus.north) 	--	(con_2.south);
        \draw[-]	(consensus.north) 	--	(con_3.south);
        \draw[-]	(con_1.north)		--	(con_4.south);
        \draw[-]	(con_2.north)		--	(con_4.south);
        \draw[-]	(con_3.north)		--	(con_4.south);

        %Directed Consensus
        \node[block]	(di_con)	[right=of consensus]	{Directed Consensus};
        \draw[-]    (consensus.east) -- (di_con.west);
        \node[extra]    (di_con_1)  [right=of di_con]    {Strongly vs Weakly Connected};
        \draw[-]    (di_con.east) -- (di_con_1.west);
        \node[extra]    (di_con_2)  [below=of di_con_1]    {Rooted Out-branching};
        \draw[-]    (di_con.east) -- (di_con_2.west);

        %Time-Varying Consensus
        \node[block]	(tv_con)	[left=of consensus]	{Time Varying Consensus};
        \draw[-]    (consensus.west) -- (tv_con.east);
        \node[extra]    (tv_con_1) [left=of tv_con] {Switched Networks};
        \draw[-]    (tv_con.west) -- (tv_con_1.east);
        \node[extra, text width = 40mm]    (tv_con_2) [below=of tv_con_1] {Universal vs Existential Stability};
        \draw[-]    (tv_con.west) -- (tv_con_2.east);
        \draw[-]    (lyap.west) -- (tv_con_2.east);

        %Leader-Follower System
        % \node[extra] 

		% %Main Lines
		% \draw[-] (applications.west) 	.. controls +(left:5mm) and +(up:3mm)  ..	(ctrl_pblms.north); %controls +(up:5mm) and +(left:5mm)
		% \draw[-] (applications.east) 	.. controls +(right:5mm) and +(up:3mm) .. (network_model.north);
		% \draw[-] (ctrl_pblms.south) 	.. controls +(down:7mm) and +(left:7mm)  .. (consensus.west);
		% \draw[-] (network_model.south)	.. controls +(down:7mm) and +(right:7mm) ..	(consensus.east);

		% %Applications
		% \node[extra]	(app_2)		[below=of applications]	{``Smart'' Grids};
		% \node[extra]	(app_1)		[left=of app_2]			{Groups of UAVs};
		% \node[extra]	(app_3)		[right=of app_2]		{Comm Networks};
		% \draw[-]	(applications.south) -- (app_1.north);
		% \draw[-]	(applications.south) -- (app_2.north);
		% \draw[-]	(applications.south) -- (app_3.north);

		% %Control Problems
		% \node[extra]	(ctr_2)		[left=of ctrl_pblms]	{Formation};
		% \node[extra]	(ctr_1)		[above=of ctr_2]		{Rendezvous};
		% \node[extra]	(ctr_3)		[below=of ctr_2]		{Flocking};
		% \draw[-]	(ctrl_pblms.west)	--	(ctr_1.east);
		% \draw[-]	(ctrl_pblms.west)	--	(ctr_2.east);
		% \draw[-]	(ctrl_pblms.west)	--	(ctr_3.east);

		% %Network Models
		% \node[extra]	(graph_2)	[right=of network_model]	{Dynamic vs Static};
		% \node[extra]	(graph_1)	[above=of graph_2]			{Proximity-Based};
		% \node[extra]	(graph_3)	[below=of graph_2]			{Directed vs Undirected};
		% \draw[-]	(network_model.east)	--	(graph_1.west);
		% \draw[-]	(network_model.east)	--	(graph_2.west);
		% \draw[-]	(network_model.east)	--	(graph_3.west);

		

	\end{tikzpicture}}
	\caption{Diagram of Course Topics (created w/ TikZ)}
	\label{fig:pblm1}
\end{figure}

% Problem 2 -------------------------------------------------
\newpage
\section{}
Recall that if $x_i$ is scalar, with its derivative given by the consensus equation \[
    \dot{x}_i = \sum_{j \in \mathcal{N}_i} (x_j - x_i), \ i = 1, 2, \cdots, N
\] this can be written as \[
    \dot{x} = - L x
\] where $L$ is the Laplacian of the undirected graph, 
and $x = \mqty[x_1 x_2 \cdots x_N]^T$.

\subsection{}
\subsubsection*{Problem:}
If instead\[
    \dot{x} = - L^2 x
\] what are the corresponding node level dynamics, that is, find \[
    \dot{x}_i = ???
\]
\subsubsection*{Preliminaries}
\begin{definition} \label{def:graph_matrices}
	Let graph $G(V,E)$ with $V = \qty{v_1,\dots,v_n}$ and $E \subseteq V \cross V$.
	\begin{enumerate}
		\item The \underline{\emph{degree matrix}} $\Delta \in \R^{n\cross n}$ is a diagonal matrix defined as \[
			\Delta := \mqty[\dmat{\deg(v_1), \deg(v_2), \ddots, \deg(v_n)}]
		\]
		\item The \emph{\underline{adjacency matrix}} $A \in \R^{n\cross n}$ is a symmetric matrix $(A = A^T)$ defined s.t. \[
			A = [a_{ij}] \st a_{ij} \begin{cases}
				1 &(v_i,v_j) \in V\\
				0 &(v_i,v_j) \notin V
			\end{cases}
		\]
		\item The \emph{\underline{incidence matrix}} $D \in \R^{n \cross m}$ is defined as\[
			D = [d_{ij}] \st d_{ij} \begin{cases}
				1 	&(v_i,-) \in e_{j}\\
				-1	&(-,v_i) \in e_{j}\\
				0	&\text{otherwise}
			\end{cases}
		\]
		\item The \emph{\underline{Laplacian matrix}} $L \in \R^{n \cross n}$ is a symmetric $(L = L^T)$ and strictly semi-positive definite $(L \succeq 0)$ is defined as\[
			L := \Delta - A = D D^T
		\]and\[
			L = \mqty[
				\deg(v_1)	&-a_{12}	&-a_{13}	&\cdots	&-a_{1n}\\
				-a_{21}		&\deg(v_2)	&-a_{23}	&\cdots	&-a_{2n}\\
				\vdots		&\vdots		&\vdots		&\ddots	&\vdots\\
				-a_{n1}		&-a_{n2}	&-a_{n3}	&\cdots	&\deg(v_n)
			]
		\]
		\item For a weighted graph $G(V,E,W)$, the diagonal weighted matrix $W\in \R^{m\cross m}$ is defined as\[
			W = [w_{ij}] \forall_{ij \in E}
		\]
		were $w_{ij}$ are the corresponding weights for $e_{ij} = (v_i,v_j)$.
	\end{enumerate}
\end{definition}

\begin{definition} \label{def:consensus_dynamics}
	Let undirected and unweighted graph $G(V,E)$ with $V = \qty{v_1,\dots,v_n}$ and $E \subseteq V \cross V$.
	The \emph{\underline{consensus dynamics}} of network $G(V,E)$ is defined by\[
		\forall_{i=1,\dots,n} \ \dot{x}_i = \sum_{j\in \mathcal{N}_i} (x_j - x_i)
		\iff \dot{x} = -L x
	\] For the case with weighted graph $G(V,E,W)$ with diagonal weight matrix $W = [w_{ij}]$, 
	\emph{\underline{weighted consensus dynamics}} are given as\[
		\dot{x}_i = \sum_{j\in\mathcal{N}_i} w_{ij} (x_j - x_i) 
		\implies \dot{x} = - L_{w} x
	\]where weighted Laplacian matrix $L_{w}$ is defined as\[
		L_{w} = D W D^T
	\]
\end{definition}


\subsubsection*{Solution:}
From the definition of the Laplacian Matrix (Definition \ref{def:graph_matrices}), we have\[
    L = \Delta - A
\] and therefore \begin{align*}
    L^2 &= L * L = (\Delta - A) (\Delta - A)\\
        &= \Delta^2 - \Delta A - A \Delta + A^2\\
        &= \mqty[
            \deg(v_1)^2	&0	&0	&\cdots	&0\\
            0		&\deg(v_2)^2	&0	&\cdots	&0\\
            \vdots		&\vdots		&\vdots		&\ddots	&\vdots\\
            0		&0	&0	&\cdots	&\deg(v_n)^2
        ] \\ &\qquad + \mqty[
            0	&-a_{12} \deg(v_1)	&-a_{13} \deg(v_1)	&\cdots	&-a_{1n} \deg(v_1)\\
            -a_{21}	\deg(v_2)	&0	&-a_{23} \deg(v_2)	&\cdots	&-a_{2n} \deg(v_2)\\
            \vdots		&\vdots		&\vdots		&\ddots	&\vdots\\
            -a_{n1}	\deg(v_n)	&-a_{n2} \deg(v_n)	&-a_{n3} \deg(v_n)	&\cdots	&0
        ] \\ &\qquad + \mqty[
            0	&-a_{12} \deg(v_1)	&-a_{13} \deg(v_2)	&\cdots	&-a_{1n} \deg(v_3)\\
            -a_{21}	\deg(v_1)	&0	&-a_{23} \deg(v_2)	&\cdots	&-a_{2n} \deg(v_3)\\
            \vdots		&\vdots		&\vdots		&\ddots	&\vdots\\
            -a_{n1}	\deg(v_1)	&-a_{n2} \deg(v_2)	&-a_{n3} \deg(v_3)	&\cdots	&0
        ] \\ &\qquad + \mqty[
            \sum_{i \neq 1}^n a_{1,i} a_{i,1} & \sum_{i \neq 1,2} a_{1,i} a_{i,2} & \cdots &\sum_{i \neq 1,n} a_{1,i} a_{i,2}\\
            \sum_{i \neq 2,1} a_{2,i} a_{i,1} & \sum_{i \neq 2} a_{2,i} a_{i,2} & \cdots & \sum_{i \neq 1,n} a_{1,i} a_{i,n}\\
            \vdots  &  \vdots &\ddots &\vdots\\
            \sum_{i \neq n,1} a_{n,i} a_{i,1} & \sum_{i \neq n,2} a_{n,i} a_{i,2} &\cdots &\sum_{i\neq n} a_{n,i} a_{i,n}
        ]
\end{align*}
which results in \[\boxed{
    \dot{x}^{(i)} = - \qty(\deg(v_1)^2 + \sum_{j \neq i} a_{i,j} a_{j,i}) x^{(i)} 
                    - \sum_{j \neq i} \qty(-a_{i,j} (\deg(v_i) + \deg(v_j)) + \sum_{k \neq j} a_{i,k} a_{k,j}) x^{(j)}
}\]

\subsection{}
\subsubsection*{Problem:}
Can you give a graph-theoretic interpretation to your answer in $(A)$?

\subsubsection*{Solution:}
A potential graph-theoretical interpretation could be would be a 










% Problem 3 -------------------------------------------------
\newpage
\section{}
Consider a leader-follower network with two leaders and two followers, as shown in \figurename \ref{fig:pblm3}. 
Assume that leaders and followers are on the real line, and the underlying network graph is a path graph with the end nodes being the static leaders.
Moreover, let the dynamics be given by the following:
\begin{gather*}
    \dot{x}_1 = \alpha_1((x_3-x_1) + (x_2 - x_1))\\
    \dot{x}_2 = \alpha_2((x_1-x_2) + (x_4 - x_2))\\
    \dot{x}_3 = \dot{x}_4 = 0
\end{gather*}
Where to $x_1$ and $x_2$ end up as $t \to \infty$ if $x_3 = \beta$ and $x_4 = \gamma$?

\begin{figure}[h]
    \centering
    \includegraphics[width=0.7\textwidth]{figs/pblm3.png}
    \caption{Leader-follower Network}
    \label{fig:pblm3}
\end{figure}

\subsection*{Solution:}
The dynamics of the network overall are described by the dynamics $\dot{x} = A_cls x$ with matrix \[
    A_{cls} = \mqty[
        -2 \alpha_1 & \alpha_1 & \alpha_1 &0\\
        \alpha_2 & - 2 \alpha_2 & 0 & \alpha_2\\
        0  & 0 & 0 & 0\\
        0  & 0 & 0 & 0
    ]
\] This can further be redefined into the dynamical system $\dot{x} = A x + B u$ with matrices \[
    A = \mqty[
        -2 \alpha_1 & \alpha_1\\
        \alpha_2    & -2 \alpha_2
    ]
\] \[
    B = \mqty[\dmat{
        \alpha_1,
        \alpha_2
    }]
\] where $u$ is the static "input" of \[
    u = \mqty[
        \beta\\
        \gamma
    ]
\]

Assuming that $\alpha_1, \alpha_2 > 0$, $A$ is stable and therefore the system wll decay to the reference signal $u$.
\emph{Note:} If $u$ changes then the response would be governed by transfer function $(s I - A)^{-1} B$.
The final state will be the solution to \[
    \dot{x} = 0 = A_{cls} x = A x + B u
\] which is calculated to be \[\boxed{
    x_{\infty} = \mqty[
        \cfrac{2 \beta + \gamma}{3}\\
        \cfrac{\beta + 2 \gamma}{3}
    ]
}\]
    

% Problem 4 -------------------------------------------------
\newpage
\section{}
\subsection*{Problem:}
Given an undirected network containing a total of $N$ nodes. 
There is a single anchor node that is connected to every one of the follower nodes, that is, anchor has a degree of $N-1$. 
Find the simple expression for the following quantities.
\begin{enumerate}
    \item $l$
    \item $L_f \vb{1}$
\end{enumerate}
where $L_f$ is the matrix obtained from the partition of the Laplacian matrix as we discussed in class.

Also, relate your answers to where the followers end up as $t \to \infty$.

\subsection*{Preliminaries:}
\begin{definition}\label{def:leader_follower_dynamics}
    Let undirected and unweighted graph $G(V,E)$ with $V = \qty{v_1,\dots,v_n}$ and $E \subseteq V \cross V$.
    Vertices in $V$ are classified as either \emph{leaders} ($v_i \in V_l$) or \emph{followers} ($v_i \in V_f)$. 
	The \emph{\underline{leader-follower}} dynamics of the states within network $G(V,E)$ are defined by\[\begin{cases}
        \dot{x}_i = - \sum_{j \neq N_i} (x_i - x_j) &\forall_{i \st v_i \in V_{f}}\\
        \dot{x}_i =  0 &\forall_{i \st v_i \in V_{l}}
    \end{cases}
	\] or equivalently when $V_{l} = \{v_n\}$ (single leader node) \[
        \dot{x} = \mqty[
            -L_f & - l\\
            0 & 0
        ]
    \]
\end{definition}

\subsection*{Solution:}
Assuming that the network is unweighted and the single leader is associated with $v_n$,\[
    \dot{x} = \mqty[
        -L_f & - l\\
        0 & 0
    ]
\]
\subsubsection{$l$}
Since $\deg(v_n) = N-1$, \[
    \sum_{i=1}^{N-1} l_i = N-1
\] therefore all elements must be 1 and \[
    l = \mathbf{1}_{N-1}
\]

\subsubsection{$L_f \mathbf{1}$}

\begin{align*}
    L_f \mathbf{1} 
        &= \mqty[
            \deg(v_1) & -a_{1,2} &\cdots &-a_{1,n}\\
            -a_{2,1} &\deg(v_2)  &\cdots &-a_{2,n}\\
            \vdots &\vdots &\ddots &\vdots\\
            -a_{n,1} &-a_{n,2} &\cdots &\deg(v_n)
        ] \mqty[
            1\\
            1\\
            \vdots\\
            1  
        ]\\
        &= \mqty[
            \deg(v_1) - \sum_{i \neq 1} a_{1,i}\\
            \deg(v_2) - \sum_{i \neq 2} a_{2,i}\\
            \vdots\\
            \deg(v_n) - \sum_{i \neq n} a_{n,i}\\
        ]
    \intertext{Since by definition $\deg(v_i) = \sum{j\neq i} a_{i,j}$,}
    \Aboxed{
    L_f \mathbf{1} 
        &= \mqty[
            0\\
            0\\
            \vdots\\
            0
        ] = \mathbf{0}_{N-1}}
\end{align*}



% Problem 5 -------------------------------------------------
\newpage
\section{}
\subsection*{Problem:}
Consider the (undirected) network in \figurename \ref{fig:pblm5}. 
At any instance of time, exactly one of the nodes $x$ and $y$ would be included in the network. 
So, basically, we will get a switched system. 
Assuming all nodes impliment the consensus dynamics, will they converge at one point (centroid of initial states) asymptotically?
Explain.
\begin{figure}[h]
    \centering
    \includegraphics[width=0.3\textwidth]{figs/pblm3.png}
    \caption{Network for problem 5}
    \label{fig:pblm5}
\end{figure}

\subsection*{Preliminaries:}
Include Theorems related to requirements to switched system stability... 

\subsection*{Solution:}
Within this switched system shown in \figurename \ref{fig:pblm5}, the exclusion of nodes $x$ and $y$ during any singe time-step causes the system to be disconnected into 2 connected subgraphs. 




% Problem 6 -------------------------------------------------
\newpage
\section{}
\subsection*{Problem:}
Assume we are running the (directed) consensus protocol over the three static graphs below.
In which of these cases does the protocol drive the state to $\text{span}\vb{1}$?
When does it drive the state to \[
    \frac{1}{N} \vb{1} \vb{1}^T x(0)
\] i.e. to the initial centroid?
(Explain the reasons for your answers - don't just state the answer.)

\subsection*{Preliminaries:}









\subsection{$G_1$}
\begin{figure}[h]
    \centering
    \includegraphics[width=0.5\textwidth]{figs/pblm6a.png}
    % \caption{$G_1$ for Problem 6}
\end{figure}









\subsection{$G_2$}








\subsection{$G_3$}







% Problem 7 -------------------------------------------------
\newpage
\section{}
\subsection*{Problem:}
Show that a graph that is weakly connected and balanced is also strongly connected.
(
    I do not expect a formal proof.\footnote{
        Nah...
    }
    Just discuss your main argument.\footnote{
        This sounds more difficult then actually proving it.
    }
)

\subsection*{Preliminaries:}




\subsection*{Solution:}
\begin{theorem}
    Let graph $G(V,E)$ with $V = \qty{v_1,\dots,v_n}$ and $E \subseteq V \cross V$.

    If $G(V,E)$ is weakly connected and balanced, then $G(V,E)$ is strongly connected.
    (i.e)\[
        G(V,E) \text{Weakly Connected} 
            \land G(V,E) \text{Balanced}
            \implies G(V,E) \text{Strongly Connected}
    \]
    \begin{proof}
        
    \end{proof}
\end{theorem}









\newpage
\appendix
\section{MATLAB Code:}\label{apx:matlab}
All code I write in this course can be found on my GitHub repository:\\
\href{https://github.com/jonaswagner2826/MECH6V29_MultiagentRoboticSystems}{https://github.com/jonaswagner2826/MECH6V29\_MultiagentRoboticSystems}

\bibliographystyle{ieeetran}
% \bibliography{refs.bib}
\cite{*}

\end{document}
